extends Node2D

var saved_dict = {}
var save_file_path = "user://save/"
var save_file_name = "DataSaver.tres"
var data = Data.new()

var standard_dict = { [["A#0", 400], ["C2", 300]]: [["D1", 600]], [["A#2", 200], ["C3", 200]]: [["D3", 150]], [["A#2", 300], ["C3", 200]]: [["D3", 200]], [["A#3", 150], ["A3", 150]]: [["G3", 200], ["G3", 200], ["G3", 200]], [["A#3", 150], ["C4", 150]]: [["D4", 300], ["A3", 200], ["D4", 300], ["D4", 300]], [["A#3", 150], ["G3", 200]]: [["F3", 200]], [["A#3", 200], ["A3", 150]]: [["G3", 150], ["G3", 150]], [["A#3", 300], ["C4", 200]]: [["A#3", 150]], [["A#3", 300], ["C6", 700]]: [["D6", 300]], [["A#3", 300], ["G3", 200]]: [["A3", 200]], [["A#7", 500], ["D#6", 400]]: [["G2", 350]], [["A0", 600], ["C1", 400]]: [["E1", 400], ["E1", 400], ["D1", 400], ["E1", 400], ["E1", 400], ["E1", 400], ["D1", 400], ["E1", 400], ["E1", 400], ["E1", 400], ["D1", 400], ["E1", 400]], [["A0", 800], ["D1", 500]]: [["E1", 500], ["E1", 500]], [["A1", 500], ["A#0", 400]]: [["C2", 300]], [["A2", 550], ["C5", 600]]: [["D3", 500]], [["A3", 150], ["A#3", 300]]: [["C4", 200]], [["A3", 150], ["G3", 150]]: [["C4", 300], ["F3", 300]], [["A3", 150], ["G3", 200]]: [["D4", 200], ["F3", 200], ["F3", 200]], [["A3", 200], ["B3", 200]]: [["C4", 200], ["D4", 200]], [["A3", 200], ["C4", 150]]: [["A#3", 150]], [["A3", 200], ["C4", 200]]: [["E4", 200]], [["A3", 200], ["F3", 200]]: [["C3", 300], ["D3", 150]], [["A3", 200], ["G3", 200]]: [["C4", 200]], [["A3", 300], ["C4", 200]]: [["A#3", 150]], [["A3", 300], ["F4", 350]]: [["D4", 250]], [["A3", 500], ["B3", 500]]: [["C4", 1000]], [["A3", 500], ["B3", 1000]]: [["C4", 500], ["C4", 500], ["E4", 500]], [["A3", 500], ["G3", 500]]: [["F3", 1000]], [["A3", 500], ["G3", 1000]]: [["F3", 1000]], [["A3", 1000], ["G3", 1000]]: [["A3", 500]], [["A4", 200], ["C5", 200]]: [["A4", 200], ["E5", 200], ["B4", 200]], [["A4", 200], ["F4", 200]]: [["E4", 200], ["D4", 200], ["D4", 200], ["D4", 200]], [["A4", 400], ["A4", 400]]: [["G4", 800]], [["A4", 400], ["B4", 600]]: [["C5", 800]], [["A4", 400], ["C5", 600]]: [["D5", 800]], [["A4", 400], ["F3", 350]]: [["D5", 300]], [["A4", 400], ["G4", 800]]: [["F4", 400]], [["A4", 600], ["B4", 400]]: [["C5", 800]], [["A4", 600], ["B4", 800]]: [["C5", 1200]], [["A4", 800], ["G4", 400]]: [["F#4", 600]], [["A4", 1000], ["E4", 600]]: [["F#4", 400]], [["A4", 1000], ["E5", 600]]: [["D5", 400]], [["A4", 1200], ["G4", 800]]: [["F#4", 600]], [["A5", 800], ["G5", 400]]: [["F#5", 400]], [["A5", 1200], ["G5", 800]]: [["F#5", 600]], [["A6", 700], ["F5", 300]]: [["G6", 500]], [["A7", 500], ["G1", 400]]: [["F2", 500]], [["B3", 200], ["C4", 200]]: [["D4", 200], ["E4", 200], ["D4", 200]], [["B3", 200], ["D4", 200]]: [["F4", 200]], [["B3", 200], ["E5", 500]]: [["G5", 300]], [["B3", 500], ["A3", 500]]: [["G3", 1000]], [["B3", 500], ["A3", 1000]]: [["G3", 1000]], [["B3", 500], ["C4", 1000]]: [["E4", 500]], [["B3", 1000], ["A3", 500]]: [["G3", 500], ["G3", 1000]], [["B3", 1000], ["C4", 500]]: [["D4", 500], ["D4", 500]], [["B3", 1000], ["E4", 500]]: [["F4", 500]], [["B4", 200], ["C5", 200]]: [["B4", 200], ["A4", 200]], [["B4", 200], ["D5", 200]]: [["B4", 200]], [["B4", 200], ["G4", 200]]: [["E4", 200], ["C4", 200], ["F4", 200], ["E4", 200]], [["B4", 400], ["C5", 800]]: [["E5", 1200]], [["B4", 400], ["E3", 300]]: [["G#4", 250]], [["B4", 600], ["C5", 400]]: [["D5", 600]], [["B4", 600], ["C5", 800]]: [["D5", 400]], [["B4", 800], ["A4", 400]]: [["C5", 600]], [["B4", 800], ["A4", 1000]]: [["E4", 600]], [["B5", 400], ["A#3", 300]]: [["C6", 700]], [["B5", 400], ["B7", 600]]: [["A7", 500]], [["B7", 600], ["A7", 500]]: [["G1", 400]], [["C1", 400], ["D1", 400]]: [["A0", 600], ["A0", 600], ["A0", 600]], [["C1", 400], ["E1", 400]]: [["A0", 600], ["F1", 500], ["A0", 800], ["A0", 600], ["F1", 500], ["A0", 800], ["A0", 600], ["F1", 500], ["A0", 1000]], [["C2", 300], ["D1", 600]]: [["D2", 450]], [["C3", 150], ["A#2", 300]]: [["C3", 200]], [["C3", 200], ["D3", 150]]: [["F3", 150], ["F3", 150]], [["C3", 200], ["D3", 200]]: [["G3", 200], ["F3", 200]], [["C3", 200], ["E3", 200]]: [["G3", 200], ["G3", 150], ["G3", 200]], [["C3", 300], ["A#2", 200]]: [["C3", 200]], [["C3", 300], ["D3", 150]]: [["E3", 150]], [["C3", 600], ["A#7", 500]]: [["D#6", 400]], [["C4", 150], ["A#3", 150]]: [["G3", 200]], [["C4", 150], ["A#3", 200]]: [["A3", 150]], [["C4", 150], ["A#3", 300]]: [["G3", 200]], [["C4", 150], ["A3", 200]]: [["F3", 200]], [["C4", 150], ["D4", 300]]: [["G3", 200], ["A3", 200]], [["C4", 200], ["A#3", 150]]: [["A3", 150], ["A3", 150], ["A3", 150]], [["C4", 200], ["A3", 200]]: [["B3", 200], ["B3", 200]], [["C4", 200], ["B3", 200]]: [["C4", 200]], [["C4", 200], ["D4", 200]]: [["F4", 200], ["E4", 200], ["E4", 200], ["E4", 200]], [["C4", 200], ["E4", 200]]: [["G4", 200], ["G4", 200], ["G4", 200]], [["C4", 200], ["G3", 200]]: [["A3", 200]], [["C4", 250], ["B4", 400]]: [["E3", 300]], [["C4", 300], ["D4", 200]]: [["F4", 200]], [["C4", 300], ["E4", 200]]: [["G4", 250]], [["C4", 400], ["D4", 400]]: [["E4", 400], ["E4", 400]], [["C4", 500], ["B3", 500]]: [["A3", 1000]], [["C4", 500], ["B3", 1000]]: [["A3", 500], ["A3", 500]], [["C4", 500], ["D4", 500]]: [["E4", 1000], ["E4", 1000]], [["C4", 800], ["G4", 400]]: [["G4", 400]], [["C4", 1000], ["B3", 500]]: [["A3", 500]], [["C4", 1000], ["E4", 500]]: [["D4", 500]], [["C5", 200], ["A4", 200]]: [["F4", 200], ["F4", 200]], [["C5", 200], ["B4", 200]]: [["G4", 200], ["G4", 200]], [["C5", 200], ["E5", 200]]: [["D5", 200]], [["C5", 400], ["A3", 300]]: [["F4", 350]], [["C5", 400], ["B4", 800]]: [["A4", 400]], [["C5", 400], ["D5", 400]]: [["B4", 800]], [["C5", 400], ["D5", 600]]: [["E5", 400]], [["C5", 600], ["A4", 800]]: [["G4", 400]], [["C5", 600], ["B4", 800]]: [["A4", 1000]], [["C5", 600], ["D3", 500]]: [["E5", 450]], [["C5", 600], ["D5", 800]]: [["E5", 1000]], [["C5", 800], ["A4", 1000]]: [["E5", 600]], [["C5", 800], ["D5", 400]]: [["C5", 600]], [["C5", 800], ["E5", 1200]]: [["D5", 600]], [["C6", 500], ["B5", 400]]: [["B7", 600]], [["C6", 700], ["D6", 300]]: [["C6", 500]], [["D#3", 200], ["G3", 200]]: [["C3", 200]], [["D#4", 150], ["C4", 150]]: [["A#3", 300], ["A#3", 200]], [["D#6", 400], ["G2", 350]]: [["F4", 600]], [["D1", 400], ["A0", 600]]: [["C1", 400], ["C1", 400], ["C1", 400]], [["D1", 500], ["E1", 500]]: [["F1", 500], ["F1", 500]], [["D1", 600], ["D2", 450]]: [["G5", 500]], [["D2", 450], ["G5", 500]]: [["B5", 400]], [["D3", 150], ["C3", 150]]: [["A#2", 300]], [["D3", 150], ["E3", 150]]: [["G3", 150]], [["D3", 150], ["F3", 150]]: [["G3", 300], ["G3", 300]], [["D3", 200], ["F3", 200]]: [["G3", 200]], [["D3", 200], ["G3", 200]]: [["A#3", 150]], [["D3", 300], ["A3", 200]]: [["G3", 200]], [["D3", 300], ["C3", 200]]: [["E3", 200], ["E3", 200]], [["D3", 300], ["C3", 300]]: [["A#2", 200]], [["D3", 500], ["E5", 450]]: [["G#4", 400]], [["D4", 200], ["B3", 200]]: [["C4", 200]], [["D4", 200], ["C4", 200]]: [["B3", 200]], [["D4", 200], ["E4", 200]]: [["F4", 200], ["G4", 200], ["G4", 200]], [["D4", 200], ["F4", 200]]: [["A4", 200], ["A4", 200], ["D#4", 150], ["D#4", 150]], [["D4", 200], ["G4", 200]]: [["E4", 200]], [["D4", 250], ["B3", 200]]: [["E5", 500]], [["D4", 300], ["A3", 200]]: [["F3", 200]], [["D4", 300], ["G3", 200]]: [["F3", 200]], [["D4", 400], ["C4", 800]]: [["G4", 400]], [["D4", 400], ["E4", 400]]: [["F4", 400], ["F4", 400]], [["D4", 500], ["C4", 500]]: [["B3", 1000], ["B3", 1000]], [["D4", 500], ["C4", 1000]]: [["B3", 500]], [["D4", 500], ["E4", 1000]]: [["F4", 500], ["D4", 500]], [["D4", 800], ["C4", 400]]: [["D4", 400]], [["D4", 800], ["G4", 400]]: [["G4", 400]], [["D4", 1000], ["C4", 500]]: [["B3", 500]], [["D5", 200], ["B4", 200]]: [["G4", 200], ["G4", 200]], [["D5", 300], ["C4", 250]]: [["B4", 400]], [["D5", 400], ["C5", 400]]: [["B4", 800]], [["D5", 400], ["C5", 600]]: [["A4", 800], ["B4", 800]], [["D5", 600], ["C5", 400]]: [["D5", 400]], [["D5", 600], ["C5", 800]]: [["A4", 1000]], [["D5", 600], ["E5", 400]]: [["G5", 800], ["F#5", 600]], [["D5", 800], ["E5", 1000]]: [["F#5", 600]], [["D6", 300], ["C6", 500]]: [["B5", 400]], [["E1", 400], ["A0", 600]]: [["C1", 400], ["C1", 400], ["C1", 400]], [["E1", 400], ["A0", 800]]: [["D1", 500], ["D1", 500]], [["E1", 400], ["F1", 500]]: [["E1", 500], ["E1", 500], ["E1", 500]], [["E1", 500], ["A0", 600]]: [["C1", 400], ["C1", 400], ["C1", 400]], [["E1", 500], ["F1", 500]]: [["A0", 600], ["A0", 600]], [["E2", 450], ["F#3", 500]]: [["G4", 400]], [["E3", 150], ["G3", 150]]: [["A3", 150]], [["E3", 200], ["G3", 150]]: [["F3", 150]], [["E3", 200], ["G3", 200]]: [["A#3", 150], ["A#3", 150]], [["E3", 300], ["G#4", 250]]: [["C6", 600]], [["E4", 200], ["C4", 200]]: [["A3", 200], ["G3", 200], ["D4", 200]], [["E4", 200], ["F4", 200]]: [["A4", 200], ["G4", 200]], [["E4", 200], ["G4", 200]]: [["B4", 200], ["B4", 200], ["B4", 200], ["A4", 200], ["F4", 200]], [["E4", 200], ["G4", 250]]: [["C5", 400]], [["E4", 400], ["D4", 400]]: [["C4", 800]], [["E4", 400], ["D4", 800]]: [["G4", 400], ["C4", 400]], [["E4", 400], ["E4", 400]]: [["D4", 400]], [["E4", 400], ["F4", 400]]: [["G4", 800], ["G4", 800]], [["E4", 500], ["D4", 500]]: [["C4", 1000]], [["E4", 500], ["D4", 1000]]: [["C4", 500]], [["E4", 500], ["F4", 500]]: [["G4", 1000]], [["E4", 600], ["F#4", 400]]: [["G4", 800]], [["E4", 800], ["F#4", 400]]: [["A4", 600]], [["E4", 800], ["G4", 600]]: [["A4", 400]], [["E4", 1000], ["D4", 500]]: [["C4", 500], ["C4", 500]], [["E4", 1000], ["F#4", 400]]: [["A4", 600]], [["E4", 1000], ["F4", 500]]: [["G4", 500]], [["E5", 200], ["D5", 200]]: [["B4", 200]], [["E5", 400], ["F#5", 600]]: [["G5", 400]], [["E5", 400], ["G5", 800]]: [["F#5", 400]], [["E5", 450], ["G#4", 400]]: [["A6", 700]], [["E5", 500], ["G5", 300]]: [["A4", 400]], [["E5", 600], ["D5", 400]]: [["C5", 400]], [["E5", 800], ["D5", 400]]: [["C5", 600]], [["E5", 1000], ["F#5", 600]]: [["G5", 400]], [["E5", 1200], ["D5", 600]]: [["C5", 800]], [["F#3", 500], ["G4", 400]]: [["A2", 550]], [["F#4", 400], ["A4", 600]]: [["B4", 400], ["B4", 800]], [["F#4", 400], ["G4", 800]]: [["A4", 1200]], [["F#4", 600], ["E4", 800]]: [["F#4", 400]], [["F#4", 600], ["E4", 1000]]: [["F#4", 400]], [["F#5", 400], ["D5", 600]]: [["E5", 400], ["C5", 400]], [["F#5", 400], ["G5", 400]]: [["A5", 800]], [["F#5", 600], ["E5", 800]]: [["D5", 400]], [["F#5", 600], ["G5", 400]]: [["A5", 1200], ["F#5", 400]], [["F1", 500], ["A0", 600]]: [["C1", 400], ["C1", 400]], [["F1", 500], ["E1", 500]]: [["A0", 600], ["A0", 600], ["A0", 600]], [["F2", 500], ["D3", 600]]: [["E7", 700]], [["F3", 150], ["D3", 300]]: [["A3", 200]], [["F3", 150], ["G3", 300]]: [["A#3", 150], ["A#3", 200]], [["F3", 200], ["C3", 300]]: [["D3", 150]], [["F3", 200], ["D#3", 200]]: [["G3", 200]], [["F3", 200], ["D3", 150]]: [["C3", 150]], [["F3", 200], ["D3", 300]]: [["C3", 200], ["C3", 300], ["C3", 200]], [["F3", 200], ["G3", 200]]: [["A3", 300]], [["F3", 300], ["C3", 200]]: [["D3", 200]], [["F3", 350], ["D5", 300]]: [["C4", 250]], [["F3", 1000], ["G3", 500]]: [["A3", 500], ["A3", 500]], [["F4", 200], ["A4", 200]]: [["C5", 200], ["F4", 200], ["C5", 200]], [["F4", 200], ["C4", 200]]: [["A3", 200]], [["F4", 200], ["D#4", 150]]: [["C4", 150], ["C4", 150]], [["F4", 200], ["D4", 200]]: [["G4", 200], ["B3", 200], ["C4", 200]], [["F4", 200], ["E4", 200]]: [["G4", 200], ["C4", 200]], [["F4", 200], ["G4", 200]]: [["A4", 200]], [["F4", 350], ["D4", 250]]: [["B3", 200]], [["F4", 400], ["E4", 400]]: [["E4", 400], ["D4", 800], ["D4", 800]], [["F4", 400], ["G4", 800]]: [["G4", 400]], [["F4", 500], ["E4", 500]]: [["D4", 1000]], [["F4", 500], ["G4", 500]]: [["E4", 1000]], [["F4", 500], ["G4", 1000]]: [["F4", 500]], [["F4", 600], ["E3", 500]]: [["A7", 700]], [["F5", 300], ["G6", 500]]: [["C3", 600]], [["G#4", 400], ["A6", 700]]: [["F5", 300]], [["G1", 400], ["F2", 500]]: [["D3", 600]], [["G2", 350], ["F4", 600]]: [["E3", 500]], [["G3", 150], ["A3", 150]]: [["A#3", 300]], [["G3", 150], ["C4", 300]]: [["D4", 200]], [["G3", 150], ["F3", 150]]: [["D3", 300]], [["G3", 150], ["F3", 300]]: [["C3", 200]], [["G3", 200], ["A#3", 150]]: [["C4", 150], ["C4", 150], ["C4", 150]], [["G3", 200], ["A3", 200]]: [["C4", 200], ["C4", 150]], [["G3", 200], ["A3", 300]]: [["C4", 200]], [["G3", 200], ["C3", 200]]: [["D3", 150]], [["G3", 200], ["C4", 200]]: [["A#3", 150]], [["G3", 200], ["D4", 200]]: [["F4", 200]], [["G3", 200], ["F3", 200]]: [["D#3", 200], ["D3", 300], ["D3", 300], ["D3", 300]], [["G3", 300], ["A#3", 150]]: [["C4", 150]], [["G3", 300], ["A#3", 200]]: [["A3", 150]], [["G3", 500], ["A3", 500]]: [["B3", 1000], ["B3", 1000], ["B3", 1000]], [["G3", 500], ["F3", 1000]]: [["G3", 500]], [["G3", 1000], ["A3", 500]]: [["B3", 500]], [["G3", 1000], ["F3", 1000]]: [["G3", 500]], [["G4", 200], ["A4", 200]]: [["C5", 200], ["F4", 200]], [["G4", 200], ["B4", 200]]: [["C5", 200], ["D5", 200], ["C5", 200]], [["G4", 200], ["C4", 200]]: [["D4", 200]], [["G4", 200], ["E4", 200]]: [["F4", 200], ["C4", 200], ["C4", 200]], [["G4", 200], ["F4", 200]]: [["E4", 200], ["C4", 200]], [["G4", 250], ["C5", 400]]: [["A3", 300]], [["G4", 400], ["A2", 550]]: [["C5", 600]], [["G4", 400], ["A4", 400]]: [["A4", 400]], [["G4", 400], ["F#4", 600]]: [["E4", 800]], [["G4", 400], ["F4", 400]]: [["E4", 400], ["E4", 400]], [["G4", 400], ["G4", 400]]: [["F4", 400], ["F4", 400]], [["G4", 500], ["E4", 1000]]: [["D4", 500]], [["G4", 600], ["A4", 400]]: [["B4", 600]], [["G4", 800], ["A4", 1200]]: [["G4", 800]], [["G4", 800], ["F#4", 600]]: [["E4", 1000]], [["G4", 800], ["F4", 400]]: [["E4", 400]], [["G4", 800], ["G4", 400]]: [["A4", 400]], [["G4", 1000], ["F4", 500]]: [["E4", 500]], [["G5", 300], ["A4", 400]]: [["F3", 350]], [["G5", 400], ["A5", 800]]: [["G5", 400]], [["G5", 400], ["A5", 1200]]: [["G5", 800]], [["G5", 400], ["F#5", 400]]: [["D5", 600], ["D5", 600]], [["G5", 500], ["B5", 400]]: [["A#3", 300]], [["G5", 800], ["F#5", 400]]: [["G5", 400]], [["G5", 800], ["F#5", 600]]: [["E5", 800]], [["G6", 500], ["C3", 600]]: [["A#7", 500]] }


func dir_absolute(path):
	DirAccess.make_dir_absolute(path)
func load_saved_dict():
	if FileAccess.file_exists(save_file_path + save_file_name):
		data = ResourceLoader.load(save_file_path + save_file_name)
		saved_dict = data.dict
	else:
		data.change_dict(standard_dict)
		ResourceSaver.save(data, save_file_path + save_file_name)
		load_saved_dict()
func save_dict():
	data.change_dict(saved_dict)
	ResourceSaver.save(data, save_file_path + save_file_name)

func _ready():
	dir_absolute(save_file_path)
	load_saved_dict()
	
func create(note):
	var song = []
	var possible_starts = []
	saved_dict = standard_dict
	for n in saved_dict:
		if n[0][0] == note:
			possible_starts.append(n)
	
	if possible_starts == []:
		return []
		
	var start = possible_starts.pick_random()
		
	song.append(start[0])
	song.append(start[1])

	for i in range(100): # Modify 100 for length
		
		var next = find_next(song, 0)
		
		if next[1] != 0:
			song.append(next)
		else:
			if len(song) < 10:
				return []
			return song  # Basically give up
			
	return song

func find_next(song, i):
	var prev = [song[-2-i], song[-1-i]]
	
	if prev in saved_dict:
		var b = saved_dict[prev].pick_random()
		return b
		
	else:
		if i == 5:
			return [0,0]
			
		var next = find_next(song, i+1)
		
		return next
		# Not found in corpus
